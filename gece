#################################
# mentionall Tagger Bot #
#################################
# Repo Sahibi - ByWolk 
# Telegram - t.me/StarBotKanal
# Telegram - t.me/Bywolk 
##################################
import heroku3
import random
import os, logging, asyncio
from telethon import Button
from telethon import TelegramClient, events
from telethon.sessions import StringSession
from telethon.tl.types import ChannelParticipantsAdmins
from telethon.events import StopPropagation
from config import client, USERNAME, log_qrup, startmesaj, qrupstart, komutlar, sahib, support

logging.basicConfig(
    level=logging.INFO,
    format='%(name)s - [%(levelname)s] - %(message)s'
)
LOGGER = logging.getLogger(__name__)



anlik_calisan = []
gece_tag = []

#tektag
@client.on(events.NewMessage(pattern='^(?i)/cancel'))
async def cancel(event):
  global gece_tag
  gece_tag.remove(event.chat_id)

  
# BaÅŸlanÄŸÄ±c MesajÄ±
@client.on(events.NewMessage(pattern="^/start$"))
async def start(event):
  if event.is_private:
    async for usr in client.iter_participants(event.chat_id):
     ad = f"â€¢ ğ–¬ğ–¾ğ—‹ğ—ğ–ºğ–»ğ–º [{usr.first_name}](tg://user?id={usr.id}) "
     await client.send_message(log_qrup, f"â„¹ï¸ **Yeni KullanÄ±cÄ± -** \n {ad}")
     return await event.reply(f"{ad} {startmesaj}", buttons=(
                      [
                       Button.url('ğŸ‰  ğ–¡ğ–¾ğ—‡ğ—‚ ğ–¦ğ—‹ğ—ğ–»ğ–º ğ–¤ğ—„ğ—…ğ–¾  ğŸ‰', f'https://t.me/{USERNAME}?startgroup=a')],
                      [Button.inline("ğŸ“š  ğ–ªğ—ˆğ—†ğ—ğ—ğ—…ğ–ºğ—‹  ", data="komutlar"),
                       Button.url('ğŸ“  ğ–¢ğ—ğ–ºğ—‡ğ—‡ğ–¾ğ—…  ', f'https://t.me/{support}')],
                      [Button.url('ğŸ§‘ğŸ»â€ğŸ’» É¢Éªá´›Êœá´œÊ™ á´‹á´€ÊÉ´á´€á´‹ á´‹á´á´…á´œ ğŸ§‘ğŸ»â€ğŸ’» ', f'https://github.com/MehmetAtes21/Tagger')]
                    ),
                    link_preview=False)


  if event.is_group:
    return await client.send_message(event.chat_id, f"{qrupstart}")

# BaÅŸlanÄŸÄ±c Button
@client.on(events.callbackquery.CallbackQuery(data="start"))
async def handler(event):
    async for usr in client.iter_participants(event.chat_id):
     ad = f"â€¢ ğ–¬ğ–¾ğ—‹ğ—ğ–ºğ–»ğ–º [{usr.first_name}](tg://user?id={usr.id}) "
     await event.edit(f"{ad} {startmesaj}", buttons=(
                      [
                       Button.url('ğŸ‰  ğ–¡ğ–¾ğ—‡ğ—‚ ğ–¦ğ—‹ğ—ğ–»ğ–º ğ–¤ğ—„ğ—…ğ–¾  ğŸ‰', f'https://t.me/{USERNAME}?startgroup=a')],
                      [Button.inline("ğŸ“š  ğ–ªğ—ˆğ—†ğ—ğ—ğ—…ğ–ºğ—‹  ", data="komutlar"),
                       Button.url('ğŸ“  ğ–¢ğ—ğ–ºğ—‡ğ—‡ğ–¾ğ—…  ', f'https://t.me/{support}')],
                      [Button.url('ğŸ§‘ğŸ»â€ğŸ’» É¢Éªá´›Êœá´œÊ™ á´‹á´€ÊÉ´á´€á´‹ á´‹á´á´…á´œ ğŸ§‘ğŸ»â€ğŸ’»', f'https://github.com/MehmetAtes21/Tagger')]
                    ),
                    link_preview=False)

# gece kusu
@client.on(events.callbackquery.CallbackQuery(data="komutlar"))
async def handler(event):
    await event.edit(f"{komutlar}", buttons=(
                      [
                      Button.url('ğŸ“£  ğ–²ğ—ğ—‰ğ—‰ğ—ˆğ—‹ğ—  ', f'https://t.me/Starbotdestek'),
                      Button.url('ğŸ‡¹ğŸ‡·  ğ–®ğ—ğ—‡ğ–¾ğ—‹  ', f'https://t.me/{sahib}')
                      ],
                      [
                      Button.inline("<  ğ–¦ğ–¾ğ—‹ğ—‚  >", data="start"),
                      ]
                    ),
                    link_preview=False)

# 5 li etiketleme modulÃ¼
@client.on(events.NewMessage(pattern="^/utag ?(.*)"))
async def mentionall(event):
  global gece_tag
  if event.is_private:
    return await event.respond(f"{noqrup}")
  
  admins = []
  async for admin in client.iter_participants(event.chat_id, filter=ChannelParticipantsAdmins):
    admins.append(admin.id)
  if not event.sender_id in admins:
    return await event.respond(f"{noadmin}")
  
  if event.pattern_match.group(1):
    mode = "text_on_cmd"
    msg = event.pattern_match.group(1)
  elif event.reply_to_msg_id:
    mode = "text_on_reply"
    msg = event.reply_to_msg_id
    if msg == None:
        return await event.respond("ğ–¤ğ—Œğ—„ğ—‚ ğ–¬ğ–¾ğ—Œğ–ºğ—ƒğ—…ğ–ºğ—‹ğ—‚ ğ–¦ğ—ˆğ—‹ğ–¾ğ—†ğ—‚ğ—’ğ—ˆğ—‹ğ—ğ—† ! ")
  elif event.pattern_match.group(1) and event.reply_to_msg_id:
    return await event.respond("â€¢ ğ–¤ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ–¬ğ–¾ğ—Œğ–ºğ—ƒğ—‚ ğ–¸ğ–ºğ—“ğ—†ğ–ºğ–½ğ—‚ğ—‡ ! ")
  else:
    return await event.respond("â€¢ ğ–¤ğ—ğ—‚ğ—„ğ–¾ğ— ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ğ—‡ğ–¾ ğ–»ğ–ºğ—Œğ—…ğ–ºğ—†ğ–ºğ—† ğ—‚ğ–¼ğ—‚ğ—‡ ğ–»ğ—‚ğ—‹ ğ—Œğ–¾ğ–»ğ–¾ğ—‰ ğ—’ğ–ºğ—“ğ—‚ğ—‡ ! ")
    
  if mode == "text_on_cmd":
    await client.send_message(event.chat_id, "âœ… ğ–´ğ—’ğ–¾ ğ–¾ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ ğ–»ğ–ºğ—Œğ—…ğ–ºğ–½ğ—‚ . . .",
                    buttons=(
                      [
                      Button.url('ğŸ“  ğ–ªğ–ºğ—‡ğ–ºğ—…  ğŸ“', f'https://t.me/{support}')
                      ]
                    )
                  ) 
    gece_tag.append(event.chat_id)
    usrnum = 0
    usrtxt = ""
    async for usr in client.iter_participants(event.chat_id):
      usrnum += 1
      usrtxt += f"[{usr.first_name}](tg://user?id={usr.id}) , "
      if event.chat_id not in gece_tag:
        await event.respond("â›” ğ–´ğ—’ğ–¾ ğ–¾ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ ğ–½ğ—ğ—‹ğ–½ğ—ğ—‹ğ—ğ—…ğ–½ğ— . . .",
                    buttons=(
                      [
                       Button.url('ğŸ“  ğ–ªğ–ºğ—‡ğ–ºğ—…  ğŸ“', f'https://t.me/{support}')
                      ]
                    )
                  )
        return
      if usrnum == 5:
        await client.send_message(event.chat_id, f"{msg} \n {usrtxt}")
        await asyncio.sleep(2)
        usrnum = 0
        usrtxt = ""

    

#########################

# admin etiketleme modÃ¼lÃ¼
@client.on(events.NewMessage(pattern="^/atag ?(.*)"))
async def mentionalladmin(event):
  global gece_tag
  if event.is_private:
    return await event.respond(f"{noqrup}")
  
  admins = []
  async for admin in client.iter_participants(event.chat_id, filter=ChannelParticipantsAdmins):
    admins.append(admin.id)
  if not event.sender_id in admins:
    return await event.respond(f"{noadmin}")
  
  if event.pattern_match.group(1):
    mode = "text_on_cmd"
    msg = event.pattern_match.group(1)
  elif event.reply_to_msg_id:
    mode = "text_on_reply"
    msg = event.reply_to_msg_id
    if msg == None:
        return await event.respond("ğ–¤ğ—Œğ—„ğ—‚ ğ–¬ğ–¾ğ—Œğ–ºğ—ƒğ—…ğ–ºğ—‹ğ—‚ ğ–¦ğ—ˆğ—‹ğ–¾ğ—†ğ—‚ğ—’ğ—ˆğ—‹ğ—ğ—† ! ")
  elif event.pattern_match.group(1) and event.reply_to_msg_id:
    return await event.respond("â€¢ ğ–¤ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ–¬ğ–¾ğ—Œğ–ºğ—ƒğ—‚ ğ–¸ğ–ºğ—“ğ—†ğ–ºğ–½ğ—‚ğ—‡ ! ")
  else:
    return await event.respond("â€¢ ğ–¤ğ—ğ—‚ğ—„ğ–¾ğ— ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ğ—‡ğ–¾ ğ–»ğ–ºğ—Œğ—…ğ–ºğ—†ğ–ºğ—† ğ—‚ğ–¼ğ—‚ğ—‡ ğ–»ğ—‚ğ—‹ ğ—Œğ–¾ğ–»ğ–¾ğ—‰ ğ—’ğ–ºğ—“ğ—‚ğ—‡ ! ")
    
  if mode == "text_on_cmd":
    await client.send_message(event.chat_id, "âœ… ğ– ğ–½ğ—†ğ—‚ğ—‡ ğ–¾ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ ğ–»ğ–ºğ—Œğ—…ğ–ºğ–½ğ—‚ . . .",
                    buttons=(
                      [
                       Button.url('ğŸ“  ğ–ªğ–ºğ—‡ğ–ºğ—…  ğŸ“', f'https://t.me/{support}')
                      ]
                    )
                  ) 
    gece_tag.append(event.chat_id)
    usrnum = 0
    usrtxt = ""
    async for usr in client.iter_participants(event.chat_id):
      usrnum += 1
      usrtxt += f"â€¢ [{usr.first_name}](tg://user?id={usr.id}) "
      if event.chat_id not in gece_tag:
        await event.respond("â›” ğ– ğ–½ğ—†ğ—‚ğ—‡ ğ–¾ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ ğ–½ğ—ğ—‹ğ–½ğ—ğ—‹ğ—ğ—…ğ–½ğ— . . .",
                    buttons=(
                      [
                       Button.url('ğŸ“  ğ–ªğ–ºğ—‡ğ–ºğ—…  ğŸ“', f'https://t.me/{support}')
                      ]
                    )
                  )
        return
      if usrnum == 1:
        await client.send_message(event.chat_id, f"{usrtxt} \n {msg}")
        await asyncio.sleep(2)
        usrnum = 0
        usrtxt = ""

    

#########################

# tek tek etiketleme modÃ¼lÃ¼
@client.on(events.NewMessage(pattern="^/tag ?(.*)"))
async def tektag(event):
  global gece_tag
  if event.is_private:
    return await event.respond(f"{noqrup}")
  
  admins = []
  async for admin in client.iter_participants(event.chat_id, filter=ChannelParticipantsAdmins):
    admins.append(admin.id)
  if not event.sender_id in admins:
    return await event.respond(f"{noadmin}")
  
  if event.pattern_match.group(1):
    mode = "text_on_cmd"
    msg = event.pattern_match.group(1)
  elif event.reply_to_msg_id:
    mode = "text_on_reply"
    msg = event.reply_to_msg_id
    if msg == None:
        return await event.respond("ğ–¤ğ—Œğ—„ğ—‚ ğ–¬ğ–¾ğ—Œğ–ºğ—ƒğ—…ğ–ºğ—‹ğ—‚ ğ–¦ğ—ˆğ—‹ğ–¾ğ—†ğ—‚ğ—’ğ—ˆğ—‹ğ—ğ—† ! ")
  elif event.pattern_match.group(1) and event.reply_to_msg_id:
    return await event.respond("â€¢ ğ–¤ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ–¬ğ–¾ğ—Œğ–ºğ—ƒğ—‚ ğ–¸ğ–ºğ—“ğ—†ğ–ºğ–½ğ—‚ğ—‡ ! ")
  else:
    return await event.respond("â€¢ ğ–¤ğ—ğ—‚ğ—„ğ–¾ğ— ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ğ—‡ğ–¾ ğ–»ğ–ºğ—Œğ—…ğ–ºğ—†ğ–ºğ—† ğ—‚ğ–¼ğ—‚ğ—‡ ğ–»ğ—‚ğ—‹ ğ—Œğ–¾ğ–»ğ–¾ğ—‰ ğ—’ğ–ºğ—“ğ—‚ğ—‡ ! ")
    
  if mode == "text_on_cmd":
    await client.send_message(event.chat_id, "âœ… ğ–´ğ—’ğ–¾ ğ–¾ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ ğ–»ğ–ºğ—Œğ—…ğ–ºğ–½ğ—‚ . . .",
                    buttons=(
                      [
                       Button.url('ğŸ“  ğ–ªğ–ºğ—‡ğ–ºğ—…  ğŸ“', f'https://t.me/{support}')
                      ]
                    )
                  ) 
    gece_tag.append(event.chat_id)
    usrnum = 0
    usrtxt = ""
    async for usr in client.iter_participants(event.chat_id):
      usrnum += 1
      usrtxt += f"â€¢ [{usr.first_name}](tg://user?id={usr.id}) "
      if event.chat_id not in gece_tag:
        await event.respond("â›” ğ–´ğ—’ğ–¾ ğ–¾ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ ğ–½ğ—ğ—‹ğ–½ğ—ğ—‹ğ—ğ—…ğ–½ğ— . . .",
                    buttons=(
                      [
                       Button.url('ğŸ“  ğ–ªğ–ºğ—‡ğ–ºğ—…  ğŸ“', f'https://t.me/{support}')
                      ]
                    )
                  )
        return
      if usrnum == 1:
        await client.send_message(event.chat_id, f"{usrtxt} \n {msg}")
        await asyncio.sleep(2)
        usrnum = 0
        usrtxt = ""

    

#########################

# Emoji ile etiketleme modÃ¼lÃ¼

anlik_calisan = []

tekli_calisan = []




emoji = " â¤ï¸ ğŸ§¡ ğŸ’› ğŸ’š ğŸ’™ ğŸ’œ ğŸ–¤ ğŸ¤ ğŸ¤ ğŸ™‚ ğŸ™ƒ ğŸ˜‰ ğŸ˜Œ ğŸ˜ ğŸ¥° ğŸ˜˜ ğŸ˜— ğŸ˜™ ğŸ˜š ğŸ˜‹ ğŸ˜› ğŸ˜ ğŸ˜œ ğŸ¤ª ğŸ¤¨ ğŸ§ ğŸ¤“ ğŸ˜ ğŸ¤© ğŸ¥³ ğŸ˜ ğŸ˜’ " \
        "ğŸ˜ ğŸ˜” ğŸ˜Ÿ ğŸ˜• ğŸ™ ğŸ˜£ ğŸ˜– ğŸ˜« ğŸ˜© ğŸ¥º ğŸ˜¢ ğŸ˜­ ğŸ˜¤ ğŸ˜  ğŸ˜¡  ğŸ¤¯ ğŸ˜³ ğŸ¥µ ğŸ¥¶ ğŸ˜± ğŸ˜¨ ğŸ˜° ğŸ˜¥ ğŸ˜“ ğŸ¤— ğŸ¤” ğŸ¤­ ğŸ¤« ğŸ¤¥ ğŸ˜¶ ğŸ˜ ğŸ˜‘ ğŸ˜¬ ğŸ™„ " \
        "ğŸ˜¯ ğŸ˜¦ ğŸ˜§ ğŸ˜® ğŸ˜² ğŸ¥± ğŸ˜´ ğŸ¤¤ ğŸ˜ª ğŸ˜µ ğŸ¤ ğŸ¥´ ğŸ¤¢ ğŸ¤® ğŸ¤§ ğŸ˜· ğŸ¤’ ğŸ¤• ğŸ¤‘ ğŸ¤  ğŸ˜ˆ ğŸ‘¿ ğŸ‘¹ ğŸ‘º ğŸ¤¡  ğŸ‘» ğŸ’€ ğŸ‘½ ğŸ‘¾ ğŸ¤– ğŸƒ ğŸ˜º ğŸ˜¸ ğŸ˜¹ " \
        "ğŸ˜» ğŸ˜¼ ğŸ˜½ ğŸ™€ ğŸ˜¿ ğŸ˜¾ â„ï¸ ğŸŒº ğŸŒ¨ ğŸŒ© â›ˆ ğŸŒ§ â˜ï¸ â˜€ï¸ ğŸŒˆ ğŸŒª âœ¨ ğŸŒŸ â˜ƒï¸ ğŸª ğŸŒ ğŸŒ™ ğŸŒ” ğŸŒš ğŸŒ ğŸ•Š ğŸ¦© ğŸ¦¦ ğŸŒ± ğŸŒ¿ â˜˜ ğŸ‚ ğŸŒ¹ ğŸ¥€ ğŸŒ¾ " \
        "ğŸŒ¦ ğŸƒ ğŸ‹ğŸ¦“ ğŸ… ğŸˆâ€â¬› ğŸ„ ğŸ¦„ ğŸ‡ ğŸ ğŸ· ğŸ¶ ğŸ™ˆ ğŸ™Š ğŸ» ğŸ¼ ğŸ¦Š ğŸ® ğŸ ğŸŠ ğŸ¦¨ ğŸ¦” ğŸ’ ğŸ¦£ ğŸ¦˜ ğŸ¦¥ ğŸ¦¦ ğŸ¦‡ ğŸ¦ ğŸ¥ ğŸ¦ ğŸ¦œ ğŸ•Šï¸ ğŸ¦¤ ğŸ¦¢ " \
        "ğŸ¦© ğŸ¦š ğŸ¦ƒ ğŸ£ ğŸ“ ğŸ¬ ğŸ¦ˆ ğŸ  ğŸ³ ğŸ¦— ğŸª³ ğŸ ğŸ ğŸ¦‹ ğŸŸ ğŸ•·ï¸ ğŸ¦‘".split(" ")

@client.on(events.NewMessage(pattern="^/etag ?(.*)"))
async def etag(event):
  global gece_tag
  if event.is_private:
    return await event.respond(f"{noqrup}")
  
  admins = []
  async for admin in client.iter_participants(event.chat_id, filter=ChannelParticipantsAdmins):
    admins.append(admin.id)
  if not event.sender_id in admins:
    return await event.respond(f"{noadmin}")
  
  if event.pattern_match.group(1):
    mode = "text_on_cmd"
    msg = event.pattern_match.group(1)
  elif event.reply_to_msg_id:
    mode = "text_on_reply"
    msg = event.reply_to_msg_id
    if msg == None:
        return await event.respond("ğ–¤ğ—Œğ—„ğ—‚ ğ–¬ğ–¾ğ—Œğ–ºğ—ƒğ—…ğ–ºğ—‹ğ—‚ ğ–¦ğ—ˆğ—‹ğ–¾ğ—†ğ—‚ğ—’ğ—ˆğ—‹ğ—ğ—† ! ")
  elif event.pattern_match.group(1) and event.reply_to_msg_id:
    return await event.respond("â€¢ ğ–¤ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ–¬ğ–¾ğ—Œğ–ºğ—ƒğ—‚ ğ–¸ğ–ºğ—“ğ—†ğ–ºğ–½ğ—‚ğ—‡ ! ")
  else:
    return await event.respond("â€¢ ğ–¤ğ—ğ—‚ğ—„ğ–¾ğ— ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ğ—‡ğ–¾ ğ–»ğ–ºğ—Œğ—…ğ–ºğ—†ğ–ºğ—† ğ—‚ğ–¼ğ—‚ğ—‡ ğ–»ğ—‚ğ—‹ ğ—Œğ–¾ğ–»ğ–¾ğ—‰ ğ—’ğ–ºğ—“ğ—‚ğ—‡ ! ")
    
  if mode == "text_on_cmd":
    await client.send_message(event.chat_id, "âœ… ğ–´ğ—’ğ–¾ ğ–¾ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ ğ–»ğ–ºğ—Œğ—…ğ–ºğ–½ğ—‚ . . .",
                    buttons=(
                      [
                       Button.url('ğŸ“  ğ–ªğ–ºğ—‡ğ–ºğ—…  ğŸ“', f'https://t.me/{support}')
                      ]
                    )
                  ) 
    gece_tag.append(event.chat_id)
    usrnum = 0
    usrtxt = ""
    async for usr in client.iter_participants(event.chat_id):
      usrnum += 1
      usrtxt += f"[{random.choice(emoji)}](tg://user?id={usr.id}) , "
      if event.chat_id not in gece_tag:
        await event.respond("â›” ğ–´ğ—’ğ–¾ ğ–¾ğ—ğ—‚ğ—„ğ–¾ğ—ğ—…ğ–¾ğ—†ğ–¾ ğ—‚ğ—Œğ—…ğ–¾ğ—†ğ—‚ ğ–½ğ—ğ—‹ğ–½ğ—ğ—‹ğ—ğ—…ğ–½ğ— . . .",
                    buttons=(
                      [
                       Button.url('ğŸ“  ğ–ªğ–ºğ—‡ğ–ºğ—…  ğŸ“', f'https://t.me/{support}')
                      ]
                    )
                  )
        return
      if usrnum == 5:
        await client.send_message(event.chat_id, f"{usrtxt} \n {msg}")
        await asyncio.sleep(2)
        usrnum = 0
        usrtxt = ""

    

#########################
